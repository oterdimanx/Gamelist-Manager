<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gamelist Manager</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <div class="scanlines"></div>
  <div class="container">
    <header>
      <h1>Gamelist Manager</h1>
      <p class="subtitle">Merge & Manage Your Retro Gamelists</p>
    </header>
    <div id="auth-nav">
      <button id="login-btn" onclick="netlifyIdentity.open()">Login/Sign Up</button>
      <button id="logout-btn" onclick="netlifyIdentity.logout()" style="display: none;">Logout</button>
      <div id="menu">
        <a href="/">Home</a>
        <a href="/dashboard.html" id="dashboard-link" style="display: none;">Dashboard</a>
      </div>
    </div>
    <main>
      <div class="card">
        <form id="form">
          <div class="form-group">
            <label for="system">System</label>
            <select id="system" onchange="updateIgnores()">
              <option value="mame">MAME</option>
              <option value="megadrive">Megadrive/Genesis</option>
              <option value="gamegear">Game Gear</option>
              <option value="snes">Super Nintendo/Super Famicom</option>
              <option value="sms">Master System</option>
              <option value="n64">Nintendo 64</option>
              <option value="pce">PC Engine</option>
              <option value="pcecd">PC Engine CD</option>
              <option value="nes">Nintendo Entertainment System</option>
              <option value="gb">Game Boy</option>
              <option value="32x">32 X</option>
              <option value="2600">Atari 2600</option>
              <option value="saturn">Sega Saturn</option>
              <option value="psx">Sony Playstation</option>
            </select>
          </div>
          <div class="form-group">
            <label for="ignore">Ignore Fields (comma-separated)</label>
            <input type="text" id="ignore" placeholder="path,lastplayed">
          </div>
          <div class="form-group">
            <label for="initialFile">Initial XML <span class="icon icon-floppy"></span></label>
            <input type="file" id="initialFile">
            <button type="button" class="btn" onclick="importInitial()">Import Initial</button>
          </div>
          <div class="form-group">
            <label for="completeFile">Complete XML <span class="icon icon-floppy"></span></label>
            <input type="file" id="completeFile">
            <button type="button" class="btn" onclick="mergeComplete()">Merge Complete</button>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-export" onclick="exportMerged()">Export & Download <span class="icon icon-download"></span></button>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-clean" onclick="cleanImages()">Clean Images <span class="icon icon-download"></span></button>
          </div>
        </form>
        <div id="status" class="status">
          <div id="progress" class="progress hidden">
            <div class="progress-bar"></div>
          </div>
          <span id="status-text"></span>
          <span id="action-status"></span>
        </div>
        <div id="stats" class="hidden">
          <h3>System Statistics</h3>
          <table>
            <tr><th>Metric</th><th>Value</th></tr>
            <tbody id="stats-body"></tbody>
          </table>
      </div>
      </div>
    </main>
  </div>
  <script>
    function updateIgnores() {
      const system = document.getElementById('system').value;
      const ignoreInput = document.getElementById('ignore');
      if (system === 'mame') {
        ignoreInput.value = 'path,lastplayed,playcount,timeplayed';
      } else if (system === 'megadrive' || system === 'gamegear' || system === 'snes' || system === 'sms' 
      || system === 'n64' || system === 'pce' || system === 'nes' || system === 'gb' || system === '32x'
      || system === 'saturn' || system === 'psx' || system === 'pcecd' || system === '2600' || system === 'gba'
      || system === 'fbneo'  || system === '5200'  || system === '7800' || system === 'x68000'
    ) {
        ignoreInput.value = 'path,ratio,region';
      } else {
        ignoreInput.value = '';
      }
    }
    updateIgnores();
  </script>
  <script src="app.js"></script>
</body>
</html>